<md-button class="md-fab md-primary md-hue-2 chat-fab"
           aria-label="Open Chat Window"
           ng-click="vm.panelsToggle()">
    <ng-md-icon icon="people"></ng-md-icon>
</md-button>

<div class="chat-panel-wrapper" ng-class="{'toggle-chat': vm.chatToggle === true}" layout="column" ng-cloak>

    <section class="userName">
        <h1>{{vm.currentUserInfo.fullName}}</h1>
    </section>



    <md-content flex>
        <md-tabs md-dynamic-height md-center-tabs md-stretch-tabs="always" md-no-pagination>

            <md-tab label="History" class="user-tab">

                <md-toolbar layout="column" layout-align="center center">
                    <div flex class="md-toolbar-tools" layout="row">
                        <md-autocomplete
                            flex
                            md-no-cache="true"
                            md-selected-item="vm.selectedUser"
                            md-selected-item-change="vm.onAutocompleteSelect(user.id)"
                            md-search-text="vm.searchText"
                            md-require-match="true"
                            md-items="user in vm.getFullNamesByString(vm.searchText)"
                            md-item-text="user.fullName"
                            md-dropdown-items="3"
                            md-min-length="1"
                            placeholder="{{vm.autocompletePlaceholder}}">
                            <md-item-template>
                                <span md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{user.fullName}}</span>
                            </md-item-template>
                            <md-not-found>
                                 No user "{{vm.searchText}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                        <ng-md-icon icon="search"></ng-md-icon>
                    </div>
                </md-toolbar>

                <ul class="chatList">
                    <li class="noselect" ng-click="vm.openChatWindow(chat.id)" ng-repeat="chat in vm.currentUserInfo.chatHistory track by $index" layout="row">
                        <md-tooltip>{{chat.id}}</md-tooltip>
                        <div class="avatar" layout="row"  layout-align="center center">
                            <md-icon>person</md-icon>
                        </div>

                        <div class="info" flex>
                            <div class="fullName">{{chat.participants[0] == vm.currentUserInfo.fullName ? chat.participants[1] : chat.participants[0]}}<span ng-if="chat.participants.length > 2">(+{{chat.participants.length - 1}})</span></div>

                            <div class="fullName" ng-repeat="participant in chat.participants"  ng-if="chat.participants.length <= 2 && participant.id !== vm.accessToken">{{participant.fullName}}</div>

                            <div class="lastChatMessageText">{{chat.lastChatSender.fullName}}: {{chat.lastChatMessageText}}</div>
                            <div class="lastChatDate">{{chat.lastChatDate | date:'medium'}}</div>
                        </div>

                    </li>
                </ul>

            </md-tab>




            <md-tab label="Rooms">
                <md-toolbar layout="column" layout-align="center center">
                    <div flex class="md-toolbar-tools" layout="row">
                        <input type="text" ng-model="vm.createRoomName">
                        <span flex></span>
                        <md-button class="md-button md-accent md-raised" ng-click="vm.createRoom(vm.createRoomName)">
                            Add Room
                        </md-button>
                    </div>
                    <div flex class="md-toolbar-tools" layout="row">
                        <input type="text" ng-model="vm.searchRoomName">
                        <span flex></span>
                        <ng-md-icon icon="search"></ng-md-icon>
                    </div>
                </md-toolbar>
                <md-list flex>
                    <md-list-item class="md-3-line" ng-repeat="room in vm.rooms | filter: vm.searchRoomName"
                                  ng-click="vm.changeRoomInstance(room)">
                        <div class="md-list-item-text" layout="row">
                            <h3>{{room.name}}</h3>
                            <span flex></span>
                            <ng-md-icon icon="chat" ng-show="room.newText"></ng-md-icon>
                        </div>
                    </md-list-item>
                </md-list>
            </md-tab>



            <md-tab label="Settings">
                <md-content flex layout-padding>
                    <md-switch ng-model="vm.userSettings.enableNotifications" aria-label="Switch 2" ng-true-value="'yup'" ng-false-value="'nope'" class="md-warn">
                        <span flex>Rich Notfcatons</span>
                    </md-switch>
                </md-content>

            </md-tab>
        </md-tabs>
    </md-content>
</div>


<div class="chat-container"></div>

<!--<chat-window-->
        <!--toggled="vm.singleToggle"-->
        <!--chat-instance="vm.chatInstance"-->
        <!--msg-send-function="vm.sendMsgToChatInstance"-->
        <!--file-upload="vm.fileUpload"-->
        <!--file-download="vm.fileDownload"-->
<!--&gt;-->
<!--</chat-window>-->